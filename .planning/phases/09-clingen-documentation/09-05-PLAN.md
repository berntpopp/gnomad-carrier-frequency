---
phase: 09-clingen-documentation
plan: 05
type: execute
wave: 2
depends_on: []
files_modified:
  - src/config/help/methodology.json
  - src/config/help/faq.json
  - src/components/MethodologyDialog.vue
  - src/components/FaqDialog.vue
  - src/components/AppFooter.vue
autonomous: true

must_haves:
  truths:
    - "User can access methodology explanation"
    - "Methodology includes Hardy-Weinberg formula and assumptions"
    - "User can access FAQ with expandable sections"
    - "FAQ covers gnomAD data, calculations, usage, limitations"
  artifacts:
    - path: "src/config/help/methodology.json"
      provides: "Methodology content structured data"
      min_lines: 30
    - path: "src/config/help/faq.json"
      provides: "FAQ content with categories"
      min_lines: 50
    - path: "src/components/MethodologyDialog.vue"
      provides: "Methodology explanation dialog"
      min_lines: 80
    - path: "src/components/FaqDialog.vue"
      provides: "FAQ accordion dialog"
      min_lines: 60
  key_links:
    - from: "src/components/MethodologyDialog.vue"
      to: "src/config/help/methodology.json"
      via: "content import"
      pattern: "methodology"
    - from: "src/components/FaqDialog.vue"
      to: "src/config/help/faq.json"
      via: "content import"
      pattern: "faq"
    - from: "src/components/AppFooter.vue"
      to: "src/components/MethodologyDialog.vue"
      via: "component usage"
      pattern: "MethodologyDialog"
---

<objective>
Create help system with methodology documentation (Hardy-Weinberg explanation, carrier frequency formula) and FAQ with categorized expandable sections.

Purpose: DOC-03, DOC-04, DOC-05, DOC-06 require methodology explanation including Hardy-Weinberg principles and FAQ with expandable accordion sections covering gnomAD data questions.

Output: JSON content files for methodology and FAQ, dialog components for each, integrated into app footer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-clingen-documentation/09-RESEARCH.md
@.planning/phases/09-clingen-documentation/09-CONTEXT.md

# Existing patterns
@src/components/AppFooter.vue
@src/config/templates/de.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create methodology and FAQ content files</name>
  <files>src/config/help/methodology.json, src/config/help/faq.json</files>
  <action>
Create `src/config/help/methodology.json`:

```json
{
  "title": "Carrier Frequency Calculation Methodology",
  "sections": [
    {
      "id": "overview",
      "title": "Overview",
      "content": "This calculator estimates carrier frequencies for autosomal recessive conditions using population allele frequency data from the Genome Aggregation Database (gnomAD). The calculation is based on the Hardy-Weinberg equilibrium principle."
    },
    {
      "id": "hardy-weinberg",
      "title": "Hardy-Weinberg Equilibrium",
      "content": "The Hardy-Weinberg principle describes the relationship between allele frequencies and genotype frequencies in a large, randomly mating population. For a gene with two alleles (normal allele A with frequency p, and disease allele a with frequency q), where p + q = 1, the genotype frequencies at equilibrium are:",
      "formula": {
        "genotypes": [
          { "genotype": "AA (homozygous normal)", "frequency": "p²" },
          { "genotype": "Aa (heterozygous carrier)", "frequency": "2pq" },
          { "genotype": "aa (homozygous affected)", "frequency": "q²" }
        ]
      }
    },
    {
      "id": "calculation",
      "title": "Carrier Frequency Calculation",
      "content": "For diseases caused by multiple pathogenic variants, we sum the allele frequencies of all pathogenic variants to get the total disease allele frequency (q). The carrier frequency is then approximated as 2q (since 2pq ≈ 2q when q is small).",
      "steps": [
        "1. Identify pathogenic variants in the gene (LoF HC and/or ClinVar P/LP)",
        "2. Sum allele frequencies: q = Σ(variant allele frequencies)",
        "3. Calculate carrier frequency: 2q",
        "4. For affected frequency: q²"
      ]
    },
    {
      "id": "assumptions",
      "title": "Assumptions",
      "content": "The Hardy-Weinberg equilibrium assumes:",
      "list": [
        "Random mating in the population",
        "No new mutations occurring",
        "No natural selection against carriers or affected individuals",
        "Infinitely large population (no genetic drift)",
        "No migration (gene flow)"
      ]
    },
    {
      "id": "limitations",
      "title": "Limitations",
      "content": "Important limitations to consider:",
      "list": [
        "Founder effects may cause higher frequencies in specific populations (e.g., CFTR in European populations)",
        "Consanguinity increases risk beyond Hardy-Weinberg predictions",
        "Some variants may have incomplete penetrance",
        "gnomAD population categories may not precisely match patient ancestry",
        "Rare variants may not be well-represented in gnomAD",
        "Some pathogenic variants may not be annotated in ClinVar"
      ]
    }
  ]
}
```

Create `src/config/help/faq.json`:

```json
{
  "title": "Frequently Asked Questions",
  "categories": [
    {
      "id": "gnomad-data",
      "title": "gnomAD Data",
      "questions": [
        {
          "id": "what-is-gnomad",
          "question": "What is gnomAD?",
          "answer": "The Genome Aggregation Database (gnomAD) is a resource developed by the Broad Institute that aggregates exome and genome sequencing data from large-scale sequencing projects. It provides allele frequency information from over 140,000 individuals (v4), making it the largest publicly available reference for population allele frequencies."
        },
        {
          "id": "gnomad-versions",
          "question": "What gnomAD versions are available?",
          "answer": "This calculator supports gnomAD v4.1 (latest, GRCh38) and v2.1.1 (legacy, GRCh37). Version 4 includes more samples and uses the updated GRCh38 reference genome. Version 2.1.1 may still be preferred for some clinical workflows that use GRCh37."
        },
        {
          "id": "population-categories",
          "question": "How are populations defined in gnomAD?",
          "answer": "gnomAD uses genetic ancestry-based population categories including: African/African American (afr), Admixed American (amr), Ashkenazi Jewish (asj), East Asian (eas), Finnish (fin), Non-Finnish European (nfe), Middle Eastern (mid), South Asian (sas), and remaining individuals. These are based on principal component analysis of genetic data, not self-reported ethnicity."
        },
        {
          "id": "allele-frequency",
          "question": "What does allele frequency mean?",
          "answer": "Allele frequency is the proportion of chromosomes in a population that carry a specific variant. For autosomal genes, each individual has two copies, so 1000 individuals contribute 2000 alleles. An allele frequency of 0.01 means 1% of chromosomes carry that variant."
        }
      ]
    },
    {
      "id": "calculations",
      "title": "Calculations",
      "questions": [
        {
          "id": "carrier-vs-affected",
          "question": "What is the difference between carrier frequency and affected frequency?",
          "answer": "Carrier frequency (2pq ≈ 2q) represents the proportion of individuals who carry one copy of a pathogenic variant but are unaffected. Affected frequency (q²) represents the proportion of individuals who carry two pathogenic variants and are affected by the condition. For rare recessive conditions, carrier frequency is much higher than affected frequency."
        },
        {
          "id": "recurrence-risk",
          "question": "How is recurrence risk calculated?",
          "answer": "For autosomal recessive conditions, if both parents are carriers, each child has a 25% (1 in 4) chance of being affected. If one parent is affected and one is a carrier, the risk is 50%. The calculator shows carrier frequency to help estimate the probability that a partner is a carrier."
        },
        {
          "id": "why-sum-af",
          "question": "Why do you sum allele frequencies instead of using a single variant?",
          "answer": "Most genes have multiple pathogenic variants that can cause the same condition. Summing the frequencies of all known pathogenic variants gives a more accurate estimate of total disease allele frequency. Using only one variant would underestimate carrier frequency."
        }
      ]
    },
    {
      "id": "usage",
      "title": "Using the Calculator",
      "questions": [
        {
          "id": "which-population",
          "question": "Which population should I use?",
          "answer": "Select the population that best matches your patient's genetic ancestry. If ancestry is unknown or mixed, consider using 'Global' frequencies. For specific ethnic backgrounds, use the corresponding gnomAD population. Note that self-reported ethnicity may not always match genetic ancestry."
        },
        {
          "id": "filter-settings",
          "question": "What do the filter settings mean?",
          "answer": "LoF HC (Loss-of-Function High Confidence): Includes predicted loss-of-function variants. Missense: Includes missense variants (may increase carrier frequency estimates). ClinVar P/LP: Includes variants classified as Pathogenic or Likely Pathogenic in ClinVar. Star threshold: Minimum ClinVar review stars required (higher = more evidence)."
        },
        {
          "id": "no-variants",
          "question": "Why does the calculator show no variants for my gene?",
          "answer": "This can happen if: (1) No pathogenic variants are annotated for this gene in ClinVar, (2) The gene is not well-covered in gnomAD, (3) Your filter settings are too restrictive. Try enabling missense variants or lowering the ClinVar star threshold."
        }
      ]
    },
    {
      "id": "limitations",
      "title": "Limitations",
      "questions": [
        {
          "id": "clinical-use",
          "question": "Can I use these results for clinical decisions?",
          "answer": "This tool is intended for research and educational purposes. Results should be verified by a clinical laboratory before use in patient care. The calculator provides estimates based on population data and may not reflect individual patient risk accurately."
        },
        {
          "id": "founder-effects",
          "question": "What about founder effects?",
          "answer": "Founder effects can cause certain pathogenic variants to be much more common in specific populations than the general population (e.g., CFTR F508del in Europeans, HBB sickle cell variant in African populations). gnomAD population-specific frequencies help account for this, but localized populations within these groups may still have different frequencies."
        },
        {
          "id": "missing-variants",
          "question": "Why might pathogenic variants be missing?",
          "answer": "Not all pathogenic variants are annotated in ClinVar or gnomAD. Novel variants, variants in difficult-to-sequence regions, or variants not yet reported in the literature may be missing. The calculated carrier frequency is a minimum estimate based on known variants."
        }
      ]
    }
  ]
}
```
  </action>
  <verify>JSON files are valid (no syntax errors), content is comprehensive</verify>
  <done>Help content files created with methodology sections and categorized FAQ</done>
</task>

<task type="auto">
  <name>Task 2: Create MethodologyDialog and FaqDialog components</name>
  <files>src/components/MethodologyDialog.vue, src/components/FaqDialog.vue</files>
  <action>
Create `src/components/MethodologyDialog.vue`:

```vue
<template>
  <v-dialog
    v-model="dialog"
    max-width="700"
    scrollable
  >
    <template #activator="{ props }">
      <slot
        name="activator"
        :props="props"
      />
    </template>

    <v-card>
      <v-card-title class="d-flex align-center">
        <v-icon start>mdi-function-variant</v-icon>
        {{ methodology.title }}
        <v-spacer />
        <v-btn
          icon
          variant="text"
          @click="dialog = false"
        >
          <v-icon>mdi-close</v-icon>
        </v-btn>
      </v-card-title>

      <v-divider />

      <v-card-text class="methodology-content">
        <template
          v-for="section in methodology.sections"
          :key="section.id"
        >
          <h3 class="text-h6 mt-4 mb-2">{{ section.title }}</h3>
          <p class="text-body-2 mb-3">{{ section.content }}</p>

          <!-- Formula display -->
          <v-card
            v-if="section.formula"
            variant="tonal"
            class="mb-4 pa-3"
          >
            <div class="text-subtitle-2 mb-2">Genotype Frequencies:</div>
            <div
              v-for="item in section.formula.genotypes"
              :key="item.genotype"
              class="d-flex align-center mb-1"
            >
              <code class="mr-2">{{ item.frequency }}</code>
              <span class="text-body-2">{{ item.genotype }}</span>
            </div>
          </v-card>

          <!-- Steps list -->
          <v-card
            v-if="section.steps"
            variant="outlined"
            class="mb-4 pa-3"
          >
            <div
              v-for="step in section.steps"
              :key="step"
              class="text-body-2 mb-1"
            >
              {{ step }}
            </div>
          </v-card>

          <!-- Bullet list -->
          <ul
            v-if="section.list"
            class="text-body-2 mb-4"
          >
            <li
              v-for="item in section.list"
              :key="item"
            >
              {{ item }}
            </li>
          </ul>
        </template>
      </v-card-text>

      <v-divider />

      <v-card-actions>
        <v-spacer />
        <v-btn
          variant="text"
          @click="dialog = false"
        >
          Close
        </v-btn>
      </v-card-actions>
    </v-card>
  </v-dialog>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import methodology from '@/config/help/methodology.json';

const dialog = ref(false);
</script>

<style scoped>
.methodology-content code {
  background-color: rgba(var(--v-theme-surface-variant), 0.4);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: monospace;
}
</style>
```

Create `src/components/FaqDialog.vue`:

```vue
<template>
  <v-dialog
    v-model="dialog"
    max-width="700"
    scrollable
  >
    <template #activator="{ props }">
      <slot
        name="activator"
        :props="props"
      />
    </template>

    <v-card>
      <v-card-title class="d-flex align-center">
        <v-icon start>mdi-help-circle</v-icon>
        {{ faq.title }}
        <v-spacer />
        <v-btn
          icon
          variant="text"
          @click="dialog = false"
        >
          <v-icon>mdi-close</v-icon>
        </v-btn>
      </v-card-title>

      <v-divider />

      <v-card-text>
        <v-expansion-panels
          v-model="openPanels"
          variant="accordion"
          multiple
        >
          <template
            v-for="category in faq.categories"
            :key="category.id"
          >
            <!-- Category header -->
            <div class="text-overline text-medium-emphasis mt-4 mb-2">
              {{ category.title }}
            </div>

            <!-- Questions in category -->
            <v-expansion-panel
              v-for="item in category.questions"
              :key="item.id"
              :title="item.question"
            >
              <v-expansion-panel-text>
                <p class="text-body-2">{{ item.answer }}</p>
              </v-expansion-panel-text>
            </v-expansion-panel>
          </template>
        </v-expansion-panels>
      </v-card-text>

      <v-divider />

      <v-card-actions>
        <v-btn
          variant="text"
          size="small"
          @click="openPanels = []"
        >
          Collapse All
        </v-btn>
        <v-spacer />
        <v-btn
          variant="text"
          @click="dialog = false"
        >
          Close
        </v-btn>
      </v-card-actions>
    </v-card>
  </v-dialog>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import faq from '@/config/help/faq.json';

const dialog = ref(false);
const openPanels = ref<number[]>([]);
</script>
```
  </action>
  <verify>Run `bun run typecheck` - components compile without errors</verify>
  <done>Methodology and FAQ dialogs created with proper content rendering</done>
</task>

<task type="auto">
  <name>Task 3: Integrate help dialogs into AppFooter</name>
  <files>src/components/AppFooter.vue</files>
  <action>
Update `src/components/AppFooter.vue` to add methodology and FAQ buttons:

```vue
<template>
  <v-footer
    app
    class="text-caption text-medium-emphasis justify-center ga-2"
  >
    <v-tooltip text="Source code on GitHub" location="top" aria-label="Source code on GitHub">
      <template #activator="{ props }">
        <v-btn
          v-bind="props"
          icon
          variant="text"
          size="small"
          href="https://github.com/berntpopp/gnomad-carrier-frequency"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Source code on GitHub"
        >
          <v-icon size="small">mdi-github</v-icon>
        </v-btn>
      </template>
    </v-tooltip>

    <span class="mx-1">|</span>

    <a
      :href="releasesUrl"
      target="_blank"
      rel="noopener noreferrer"
      class="text-decoration-none text-inherit"
    >
      v{{ version }}
    </a>

    <span class="mx-1">|</span>

    <v-tooltip text="gnomAD database" location="top" aria-label="gnomAD database">
      <template #activator="{ props }">
        <v-btn
          v-bind="props"
          icon
          variant="text"
          size="small"
          href="https://gnomad.broadinstitute.org/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="gnomAD database"
        >
          <v-icon size="small">mdi-database</v-icon>
        </v-btn>
      </template>
    </v-tooltip>

    <span class="mx-1">|</span>

    <!-- Methodology Dialog -->
    <MethodologyDialog>
      <template #activator="{ props }">
        <v-tooltip text="Calculation methodology" location="top">
          <template #activator="{ props: tooltipProps }">
            <v-btn
              v-bind="{ ...props, ...tooltipProps }"
              icon
              variant="text"
              size="small"
              aria-label="View calculation methodology"
            >
              <v-icon size="small">mdi-function-variant</v-icon>
            </v-btn>
          </template>
        </v-tooltip>
      </template>
    </MethodologyDialog>

    <!-- FAQ Dialog -->
    <FaqDialog>
      <template #activator="{ props }">
        <v-tooltip text="FAQ" location="top">
          <template #activator="{ props: tooltipProps }">
            <v-btn
              v-bind="{ ...props, ...tooltipProps }"
              icon
              variant="text"
              size="small"
              aria-label="View frequently asked questions"
            >
              <v-icon size="small">mdi-help-circle-outline</v-icon>
            </v-btn>
          </template>
        </v-tooltip>
      </template>
    </FaqDialog>
  </v-footer>
</template>

<script setup lang="ts">
import MethodologyDialog from '@/components/MethodologyDialog.vue';
import FaqDialog from '@/components/FaqDialog.vue';

const version = import.meta.env.VITE_APP_VERSION;
const releasesUrl = 'https://github.com/berntpopp/gnomad-carrier-frequency/releases';
</script>

<style scoped>
.text-inherit {
  color: inherit;
}
</style>
```

The footer now has icons for:
- GitHub (existing)
- Version (existing)
- gnomAD (existing)
- Methodology (new - function icon)
- FAQ (new - help icon)
  </action>
  <verify>Run `bun run dev`, click methodology icon - dialog opens with Hardy-Weinberg content, click FAQ icon - dialog opens with expandable sections</verify>
  <done>Help dialogs accessible from footer icons</done>
</task>

</tasks>

<verification>
1. `bun run typecheck` passes
2. `bun run lint` passes
3. `bun run dev`:
   - Footer shows methodology (function) and FAQ (help) icons
   - Click methodology icon - dialog with sections and formula
   - Click FAQ icon - dialog with categorized expandable panels
   - Accordion panels expand/collapse properly
   - "Collapse All" button works
</verification>

<success_criteria>
- Methodology dialog explains Hardy-Weinberg principle (DOC-04)
- Methodology shows carrier frequency formula and calculation steps (DOC-03)
- FAQ has expandable accordion sections (DOC-05)
- FAQ covers gnomAD data, calculations, usage, limitations (DOC-06)
- Help accessible from footer icons
</success_criteria>

<output>
After completion, create `.planning/phases/09-clingen-documentation/09-05-SUMMARY.md`
</output>
