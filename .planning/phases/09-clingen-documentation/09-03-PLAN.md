---
phase: 09-clingen-documentation
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/ClingenWarning.vue
  - src/components/wizard/StepGene.vue
  - src/components/wizard/StepResults.vue
autonomous: true

must_haves:
  truths:
    - "Warning appears when gene has no AR association in ClinGen"
    - "Positive confirmation appears when gene HAS valid AR association"
    - "Warning shows in both gene selection and results steps"
    - "Warning displays specific ClinGen classification found"
    - "Warning is non-blocking (user can continue)"
  artifacts:
    - path: "src/components/ClingenWarning.vue"
      provides: "ClinGen validation warning/confirmation component"
      min_lines: 80
    - path: "src/components/wizard/StepGene.vue"
      provides: "Gene step with ClinGen warning integration"
      contains: "ClingenWarning"
    - path: "src/components/wizard/StepResults.vue"
      provides: "Results step with ClinGen warning integration"
      contains: "ClingenWarning"
  key_links:
    - from: "src/components/ClingenWarning.vue"
      to: "src/composables/useClingenValidity.ts"
      via: "composable usage"
      pattern: "useClingenValidity"
    - from: "src/components/wizard/StepGene.vue"
      to: "src/components/ClingenWarning.vue"
      via: "component import"
      pattern: "ClingenWarning"
---

<objective>
Create ClinGen warning component and integrate it into gene selection and results steps to display non-blocking validation messages about AR association status.

Purpose: CLIN-04 requires displaying a non-blocking warning if a gene is not associated with autosomal recessive inheritance in ClinGen. Per CONTEXT.md, also show positive confirmation for valid AR genes.

Output: ClingenWarning.vue component integrated into StepGene.vue and StepResults.vue, showing appropriate status messages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-clingen-documentation/09-CONTEXT.md
@.planning/phases/09-clingen-documentation/09-01-SUMMARY.md (when available)

# Existing files to extend
@src/components/wizard/StepGene.vue
@src/components/wizard/StepResults.vue
@src/composables/useClingenValidity.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ClingenWarning component</name>
  <files>src/components/ClingenWarning.vue</files>
  <action>
Create `src/components/ClingenWarning.vue`:

```vue
<template>
  <div v-if="geneSymbol">
    <!-- Loading state -->
    <v-alert
      v-if="isLoading"
      type="info"
      variant="tonal"
      density="compact"
      class="mb-4"
    >
      <template #prepend>
        <v-progress-circular
          indeterminate
          size="20"
          width="2"
        />
      </template>
      Checking ClinGen gene-disease validity...
    </v-alert>

    <!-- Error state (cache fetch failed) -->
    <v-alert
      v-else-if="error"
      type="warning"
      variant="tonal"
      density="compact"
      class="mb-4"
    >
      <template #title>ClinGen Data Unavailable</template>
      <template #text>
        Unable to verify gene-disease validity. {{ error }}
      </template>
    </v-alert>

    <!-- Valid AR association (positive confirmation) -->
    <v-alert
      v-else-if="validity.hasAutosomalRecessive"
      type="success"
      variant="tonal"
      density="compact"
      class="mb-4"
    >
      <template #title>
        <v-icon start size="small">mdi-check-circle</v-icon>
        ClinGen AR Validated
      </template>
      <template #text>
        <div>
          <strong>{{ geneSymbol }}</strong> has validated autosomal recessive gene-disease association(s):
        </div>
        <ul class="mt-1 mb-0">
          <li v-for="entry in validity.arEntries" :key="entry.mondoId">
            {{ entry.diseaseLabel }}
            <v-chip
              size="x-small"
              variant="outlined"
              class="ml-1"
            >
              {{ entry.classification }}
            </v-chip>
          </li>
        </ul>
      </template>
    </v-alert>

    <!-- Gene found but no AR association (warning) -->
    <v-alert
      v-else-if="validity.found && !validity.hasAutosomalRecessive"
      type="warning"
      variant="tonal"
      density="compact"
      class="mb-4"
    >
      <template #title>
        <v-icon start size="small">mdi-alert</v-icon>
        No AR Association in ClinGen
      </template>
      <template #text>
        <div>
          <strong>{{ geneSymbol }}</strong> is in ClinGen but has no validated autosomal recessive associations.
        </div>
        <div
          v-if="validity.entries.length > 0"
          class="mt-1"
        >
          Found associations:
          <ul class="mt-1 mb-0">
            <li v-for="entry in validity.entries" :key="entry.mondoId">
              {{ entry.diseaseLabel }} ({{ entry.moi }})
              <v-chip
                size="x-small"
                variant="outlined"
                class="ml-1"
              >
                {{ entry.classification }}
              </v-chip>
            </li>
          </ul>
        </div>
        <div class="text-caption mt-2 text-medium-emphasis">
          Carrier frequency calculations assume autosomal recessive inheritance.
          Verify the inheritance pattern is appropriate for your clinical context.
        </div>
      </template>
    </v-alert>

    <!-- Gene not found in ClinGen (info/warning) -->
    <v-alert
      v-else-if="hasData && !validity.found"
      type="info"
      variant="tonal"
      density="compact"
      class="mb-4"
    >
      <template #title>
        <v-icon start size="small">mdi-information</v-icon>
        Gene Not in ClinGen
      </template>
      <template #text>
        <div>
          <strong>{{ geneSymbol }}</strong> was not found in the ClinGen gene-disease validity database.
        </div>
        <div class="text-caption mt-2 text-medium-emphasis">
          This does not mean the gene is not associated with disease.
          ClinGen curations are ongoing. Check primary literature for gene-disease associations.
        </div>
      </template>
    </v-alert>
  </div>
</template>

<script setup lang="ts">
import { computed, watch, onMounted } from 'vue';
import { useClingenValidity } from '@/composables';
import type { ClingenValidityResult } from '@/types';

const props = defineProps<{
  geneSymbol: string | null;
}>();

const {
  isLoading,
  error,
  hasData,
  fetchData,
  checkGene,
} = useClingenValidity();

// Compute validity result for current gene
const validity = computed<ClingenValidityResult>(() => {
  if (!props.geneSymbol || !hasData.value) {
    return { found: false, hasAutosomalRecessive: false, entries: [], arEntries: [] };
  }
  return checkGene(props.geneSymbol);
});

// Fetch ClinGen data on mount if not cached
onMounted(() => {
  fetchData();
});

// Re-fetch if data expires while component is mounted
watch(
  () => props.geneSymbol,
  () => {
    if (props.geneSymbol) {
      fetchData(); // Will skip if cache is valid
    }
  },
  { immediate: true }
);
</script>
```
  </action>
  <verify>Run `bun run typecheck` - component compiles without errors</verify>
  <done>ClingenWarning component shows positive/negative validation status with specific classifications</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ClingenWarning into StepGene</name>
  <files>src/components/wizard/StepGene.vue</files>
  <action>
Update `src/components/wizard/StepGene.vue` to include ClingenWarning below the gene search:

```vue
<template>
  <div>
    <h2 class="text-h6 mb-4">Select Gene</h2>
    <p class="text-body-2 text-medium-emphasis mb-4">
      Search for a gene symbol to calculate carrier frequency.
    </p>

    <div class="mb-4" style="max-width: 300px">
      <VersionSelector />
    </div>

    <GeneSearch @select="onGeneChange" />

    <!-- ClinGen validation warning/confirmation -->
    <ClingenWarning
      v-if="modelValue"
      :gene-symbol="modelValue.symbol"
      class="mt-4"
    />

    <!-- Gene Constraint Card -->
    <GeneConstraintCard
      v-if="modelValue"
      :constraint="geneConstraint"
      :loading="constraintLoading"
      :gnomad-version="gnomadVersion"
    />

    <div class="d-flex justify-end mt-6">
      <v-btn
        color="primary"
        :disabled="!modelValue"
        @click="$emit('complete')"
      >
        Continue
      </v-btn>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import GeneSearch from '@/components/GeneSearch.vue';
import VersionSelector from '@/components/VersionSelector.vue';
import GeneConstraintCard from '@/components/GeneConstraintCard.vue';
import ClingenWarning from '@/components/ClingenWarning.vue';
import type { GeneSearchResult } from '@/api/queries/types';
import { useGeneSearch } from '@/composables';
import { useGnomadVersion } from '@/api';

defineProps<{
  modelValue: GeneSearchResult | null;
}>();

const emit = defineEmits<{
  'update:modelValue': [gene: GeneSearchResult | null];
  complete: [];
}>();

const { geneConstraint, constraintLoading } = useGeneSearch();
const { version } = useGnomadVersion();
const gnomadVersion = computed(() => version.value);

const onGeneChange = (gene: GeneSearchResult | null) => {
  emit('update:modelValue', gene);
};
</script>
```

The ClingenWarning component is placed between the gene search and constraint card. It will show:
- Green confirmation if gene has valid AR association
- Amber warning if gene is in ClinGen but no AR association
- Info alert if gene not found in ClinGen
- Loading spinner while fetching ClinGen data
  </action>
  <verify>Run `bun run dev`, select CFTR (should show AR validated), select BRCA1 (may show different result)</verify>
  <done>StepGene shows ClinGen validation status after gene selection</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ClingenWarning into StepResults</name>
  <files>src/components/wizard/StepResults.vue</files>
  <action>
Update `src/components/wizard/StepResults.vue` to include ClingenWarning at the top of results, following the pattern from CONTEXT.md that warnings appear in BOTH locations.

Read the current StepResults.vue file first to understand its structure, then add ClingenWarning near the top of the template, after any headers but before the main results content.

The integration should:
1. Import ClingenWarning component
2. Accept geneSymbol as a prop (or derive from existing props)
3. Place ClingenWarning above the frequency results
4. Use the same :gene-symbol binding pattern as StepGene

Example addition to template (adapt to existing structure):
```vue
<!-- ClinGen validation reminder in results -->
<ClingenWarning
  v-if="gene"
  :gene-symbol="gene.symbol"
  class="mb-4"
/>
```

Import in script:
```typescript
import ClingenWarning from '@/components/ClingenWarning.vue';
```

The ClingenWarning will use cached data (already fetched in StepGene), so it displays instantly without additional API calls.
  </action>
  <verify>Run `bun run dev`, complete gene selection through to results step, verify ClinGen warning appears in both steps</verify>
  <done>StepResults shows ClinGen validation status as reminder</done>
</task>

</tasks>

<verification>
1. `bun run typecheck` passes
2. `bun run lint` passes
3. `bun run dev` - select CFTR:
   - StepGene shows green "ClinGen AR Validated" with disease list
   - StepResults shows same green confirmation
4. `bun run dev` - select a gene not in ClinGen:
   - Shows info alert "Gene Not in ClinGen"
5. Warning does not block progression (Continue button works)
</verification>

<success_criteria>
- ClingenWarning component displays 4 states: loading, error, valid AR, no AR, not found
- Warning appears in both StepGene and StepResults
- Valid AR genes show positive green confirmation
- Non-AR genes show amber warning with found associations
- Warnings are non-blocking (user can continue)
- Specific ClinGen classification shown (Definitive, Strong, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/09-clingen-documentation/09-03-SUMMARY.md`
</output>
