---
phase: 09-clingen-documentation
plan: 07
type: execute
wave: 3
depends_on: ["09-02", "09-03"]
files_modified:
  - src/components/wizard/StepGene.vue
  - src/components/wizard/StepFrequency.vue
  - src/components/wizard/StepResults.vue
  - src/components/FilterPanel.vue
  - src/components/GeneConstraintCard.vue
autonomous: true

must_haves:
  truths:
    - "Key UI elements have contextual help tooltips"
    - "Tooltips explain concepts in-place without navigation"
    - "Coverage warning displayed for genes with low exome coverage"
  artifacts:
    - path: "src/components/wizard/StepGene.vue"
      provides: "Gene step with coverage warning and tooltips"
      contains: "mdi-information"
    - path: "src/components/FilterPanel.vue"
      provides: "Filter panel with tooltips on each filter option"
      contains: "tooltip"
  key_links:
    - from: "src/components/GeneConstraintCard.vue"
      to: "gnomad_constraint.flags"
      via: "coverage flag detection"
      pattern: "flags"
---

<objective>
Add contextual help tooltips to key UI elements and implement low exome coverage warning for genes.

Purpose: DOC-07 requires contextual help tooltips on key UI elements. CLIN-06 requires warning for genes with low exome coverage. Tooltips should be self-contained explanations.

Output: Tooltips on filter options, population selector, frequency displays, and coverage warning based on gnomAD constraint flags.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-clingen-documentation/09-CONTEXT.md

# Files to enhance with tooltips
@src/components/wizard/StepGene.vue
@src/components/wizard/StepFrequency.vue
@src/components/FilterPanel.vue
@src/components/GeneConstraintCard.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add coverage warning to GeneConstraintCard</name>
  <files>src/components/GeneConstraintCard.vue</files>
  <action>
Update `src/components/GeneConstraintCard.vue` to display a separate, distinct warning for low exome coverage based on constraint flags.

Read the current GeneConstraintCard.vue (created in Plan 02) and enhance it with coverage warning:

Add a dedicated coverage warning section BEFORE or AFTER the constraint display (but visually distinct):

```vue
<!-- Low Coverage Warning - separate from constraint display -->
<v-alert
  v-if="hasLowCoverage"
  type="warning"
  variant="tonal"
  density="compact"
  class="mt-3"
>
  <template #title>
    <v-icon start size="small">mdi-signal-off</v-icon>
    Low Exome Coverage
  </template>
  <template #text>
    <div class="text-body-2">
      This gene has regions with low sequencing coverage in gnomAD.
      Carrier frequency estimates may be less reliable due to potential
      undetected variants.
    </div>
    <div class="text-caption text-medium-emphasis mt-1">
      Consider this limitation when interpreting results.
    </div>
  </template>
</v-alert>
```

Add computed property for coverage detection:

```typescript
const hasLowCoverage = computed(() => {
  const flags = props.constraint?.flags;
  if (!flags || flags.length === 0) return false;

  // Check for coverage-related flags
  // gnomAD flags include: 'lof_too_many', 'no_lof_constraint', 'low_coverage', etc.
  return flags.some(flag =>
    flag.toLowerCase().includes('coverage') ||
    flag.toLowerCase().includes('no_constraint') ||
    flag.toLowerCase().includes('no_lof')
  );
});
```

The constraint quality flags warning (already present) handles other quality issues. This adds a SEPARATE, visually distinct warning specifically for coverage as per CONTEXT.md ("separate distinct warning for low exome coverage").
  </action>
  <verify>Run `bun run dev`, select a gene with coverage flags (if available), verify separate coverage warning appears</verify>
  <done>Coverage warning displayed separately from constraint quality flags</done>
</task>

<task type="auto">
  <name>Task 2: Add contextual tooltips to FilterPanel</name>
  <files>src/components/FilterPanel.vue</files>
  <action>
Read the current FilterPanel.vue and add contextual help tooltips to each filter option. Each tooltip should explain what the filter does and when to use it.

Add info icons with tooltips next to each filter:

For LoF HC filter:
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>Loss-of-Function High Confidence</strong><br>
    Includes predicted loss-of-function variants (nonsense, frameshift,
    splice site) that pass gnomAD quality filters. These variants typically
    result in no protein product.
  </span>
</v-tooltip>
```

For Missense filter:
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>Missense Variants</strong><br>
    Includes single amino acid substitutions. Not all missense variants
    are pathogenic. Enable this if ClinVar P/LP missense variants should
    be included in the calculation.
  </span>
</v-tooltip>
```

For ClinVar filter:
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>ClinVar Pathogenic/Likely Pathogenic</strong><br>
    Includes variants classified as Pathogenic or Likely Pathogenic
    in ClinVar. This captures known disease-causing variants that may
    not be predicted as LoF.
  </span>
</v-tooltip>
```

For Star Threshold:
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>ClinVar Review Stars</strong><br>
    Minimum number of review stars required. Higher stars indicate
    more evidence and expert review.<br>
    0: Any assertion<br>
    1: Single submitter<br>
    2: Multiple submitters with consensus<br>
    3: Reviewed by expert panel<br>
    4: Practice guideline
  </span>
</v-tooltip>
```

Add style for tooltip text:
```css
.tooltip-text {
  max-width: 280px;
  display: inline-block;
}
```
  </action>
  <verify>Run `bun run dev`, hover over filter info icons, verify tooltips explain each filter</verify>
  <done>Filter panel has contextual tooltips explaining each filter option</done>
</task>

<task type="auto">
  <name>Task 3: Add tooltips to StepFrequency and StepResults</name>
  <files>src/components/wizard/StepFrequency.vue, src/components/wizard/StepResults.vue</files>
  <action>
Read StepFrequency.vue and StepResults.vue, then add contextual tooltips to key elements:

**StepFrequency.vue** - Population selector tooltip:

Add info icon next to population selector label or header:

```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>Population Selection</strong><br>
    Select the population that best matches the patient's genetic ancestry.
    gnomAD populations are based on genetic clustering, not self-reported ethnicity.
    If ancestry is unknown, consider using global frequencies.
  </span>
</v-tooltip>
```

**StepResults.vue** - Add tooltips to frequency displays:

Near carrier frequency display:
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>Carrier Frequency (2pq)</strong><br>
    The proportion of individuals who carry one copy of a pathogenic variant.
    Carriers are typically unaffected but can pass the variant to offspring.
    Calculated as approximately 2 times the sum of pathogenic allele frequencies.
  </span>
</v-tooltip>
```

Near affected frequency display (if present):
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>Affected Frequency (qÂ²)</strong><br>
    The proportion of individuals affected by this autosomal recessive condition.
    Calculated as the square of the total pathogenic allele frequency.
    Much rarer than carrier frequency due to the squared relationship.
  </span>
</v-tooltip>
```

Near variant count display:
```vue
<v-tooltip location="top">
  <template #activator="{ props }">
    <v-icon
      v-bind="props"
      size="x-small"
      class="ml-1"
    >
      mdi-information-outline
    </v-icon>
  </template>
  <span class="tooltip-text">
    <strong>Contributing Variants</strong><br>
    The number of pathogenic variants included in this calculation.
    Click to view details including variant IDs, consequences, and
    individual allele frequencies.
  </span>
</v-tooltip>
```

Ensure tooltip text uses `.tooltip-text` class and add corresponding style if not present.
  </action>
  <verify>Run `bun run dev`, navigate through wizard steps, verify tooltips appear on key metrics</verify>
  <done>Contextual tooltips explain key concepts throughout the wizard</done>
</task>

</tasks>

<verification>
1. `bun run typecheck` passes
2. `bun run lint` passes
3. `bun run dev`:
   - Gene constraint card shows coverage warning (if flags indicate)
   - Filter panel has info icons with explanatory tooltips
   - Population selector has tooltip explaining selection
   - Results step has tooltips on carrier frequency, affected frequency, variant count
   - Tooltips are self-contained (explain concept without navigation)
</verification>

<success_criteria>
- Coverage warning displays for genes with low exome coverage (CLIN-06)
- Coverage warning is visually distinct from constraint quality flags
- Filter options have contextual help tooltips (DOC-07)
- Population selector has tooltip explaining ancestry matching
- Frequency displays have tooltips explaining calculations
- Tooltips are self-contained explanations (DOC-07)
</success_criteria>

<output>
After completion, create `.planning/phases/09-clingen-documentation/09-07-SUMMARY.md`
</output>
