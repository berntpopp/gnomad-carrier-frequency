---
phase: 09-clingen-documentation
plan: 04
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/stores/useAppStore.ts
  - src/components/DisclaimerBanner.vue
  - src/components/SettingsDialog.vue
  - src/App.vue
autonomous: true

must_haves:
  truths:
    - "Disclaimer banner shown on first visit"
    - "User can acknowledge disclaimer with button click"
    - "Acknowledgment persists across sessions"
    - "Disclaimer not shown again after acknowledgment"
    - "ClinGen cache can be refreshed from settings"
  artifacts:
    - path: "src/stores/useAppStore.ts"
      provides: "App-level store with disclaimer state and ClinGen refresh"
      exports: ["useAppStore"]
    - path: "src/components/DisclaimerBanner.vue"
      provides: "First-visit disclaimer banner component"
      min_lines: 50
    - path: "src/components/SettingsDialog.vue"
      provides: "Settings with ClinGen cache management"
      contains: "ClinGen"
  key_links:
    - from: "src/components/DisclaimerBanner.vue"
      to: "src/stores/useAppStore.ts"
      via: "store access"
      pattern: "useAppStore"
    - from: "src/App.vue"
      to: "src/components/DisclaimerBanner.vue"
      via: "component usage"
      pattern: "DisclaimerBanner"
---

<objective>
Create app-level store for disclaimer state and ClinGen cache management, implement disclaimer banner shown on first visit, and add ClinGen cache refresh to settings.

Purpose: DOC-09 requires clinical disclaimer displayed appropriately. CLIN-03 requires manual ClinGen cache refresh. Per CONTEXT.md, use Phentrieve pattern: banner shown once, acknowledgment saved, reopenable from footer.

Output: useAppStore with disclaimer tracking, DisclaimerBanner component, and settings integration for ClinGen cache management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-clingen-documentation/09-CONTEXT.md

# Existing patterns
@src/stores/useFilterStore.ts
@src/components/SettingsDialog.vue
@src/App.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useAppStore</name>
  <files>src/stores/useAppStore.ts</files>
  <action>
Create `src/stores/useAppStore.ts` for app-level state:

```typescript
import { defineStore } from 'pinia';

interface AppStoreState {
  disclaimerAcknowledged: boolean;
  disclaimerAcknowledgedAt: number | null;  // Unix timestamp
}

export const useAppStore = defineStore('app', {
  state: (): AppStoreState => ({
    disclaimerAcknowledged: false,
    disclaimerAcknowledgedAt: null,
  }),

  getters: {
    /**
     * Check if disclaimer should be shown
     * Show if not acknowledged
     */
    shouldShowDisclaimer: (state): boolean => {
      return !state.disclaimerAcknowledged;
    },

    /**
     * Get human-readable acknowledgment date
     */
    acknowledgedDate: (state): string | null => {
      if (!state.disclaimerAcknowledgedAt) return null;
      return new Date(state.disclaimerAcknowledgedAt).toLocaleDateString();
    },
  },

  actions: {
    /**
     * Mark disclaimer as acknowledged
     */
    acknowledgeDisclaimer() {
      this.disclaimerAcknowledged = true;
      this.disclaimerAcknowledgedAt = Date.now();
    },

    /**
     * Reset disclaimer (for testing or re-showing)
     */
    resetDisclaimer() {
      this.disclaimerAcknowledged = false;
      this.disclaimerAcknowledgedAt = null;
    },
  },

  persist: {
    key: 'carrier-freq-app',
    storage: localStorage,
  },
});
```
  </action>
  <verify>Run `bun run typecheck` - store compiles without errors</verify>
  <done>App store created with disclaimer acknowledgment tracking</done>
</task>

<task type="auto">
  <name>Task 2: Create DisclaimerBanner component</name>
  <files>src/components/DisclaimerBanner.vue</files>
  <action>
Create `src/components/DisclaimerBanner.vue`:

```vue
<template>
  <v-dialog
    v-model="showDialog"
    max-width="600"
    persistent
    :scrim="true"
  >
    <v-card>
      <v-card-title class="d-flex align-center">
        <v-icon
          start
          color="warning"
        >
          mdi-alert-circle
        </v-icon>
        Clinical Disclaimer
      </v-card-title>

      <v-card-text>
        <v-alert
          type="warning"
          variant="tonal"
          class="mb-4"
        >
          <strong>For Research Use Only</strong>
        </v-alert>

        <p class="text-body-1 mb-3">
          This tool provides carrier frequency estimates based on gnomAD population data.
          Results are intended for research and educational purposes.
        </p>

        <p class="text-body-2 mb-3">
          <strong>Important limitations:</strong>
        </p>

        <ul class="text-body-2 mb-4">
          <li>Results should be verified by a clinical laboratory before use in patient care</li>
          <li>This tool does not replace genetic counseling or clinical judgment</li>
          <li>Population frequencies may not reflect specific patient ancestry</li>
          <li>Variant classifications are derived from gnomAD and ClinVar annotations</li>
        </ul>

        <v-divider class="mb-4" />

        <p class="text-caption text-medium-emphasis">
          By clicking "I Understand", you acknowledge these limitations and agree to use
          this tool appropriately within research and educational contexts.
        </p>
      </v-card-text>

      <v-card-actions>
        <v-spacer />
        <v-btn
          color="primary"
          variant="elevated"
          @click="acknowledge"
        >
          I Understand
        </v-btn>
      </v-card-actions>
    </v-card>
  </v-dialog>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useAppStore } from '@/stores/useAppStore';

const appStore = useAppStore();

const showDialog = computed({
  get: () => appStore.shouldShowDisclaimer,
  set: () => {
    // Only close via acknowledge button, not backdrop click
  },
});

const acknowledge = () => {
  appStore.acknowledgeDisclaimer();
};
</script>
```

The dialog is persistent (cannot be closed by clicking outside or pressing Escape) to ensure users read and acknowledge the disclaimer.
  </action>
  <verify>Run `bun run typecheck` - component compiles without errors</verify>
  <done>Disclaimer banner shows on first visit, requires explicit acknowledgment</done>
</task>

<task type="auto">
  <name>Task 3: Integrate banner and add ClinGen to settings</name>
  <files>src/App.vue, src/components/SettingsDialog.vue</files>
  <action>
Update `src/App.vue` to include DisclaimerBanner:

Add import and component:
```vue
<script setup lang="ts">
// ... existing imports ...
import DisclaimerBanner from '@/components/DisclaimerBanner.vue';
</script>

<template>
  <!-- Add DisclaimerBanner at root level -->
  <DisclaimerBanner />

  <!-- ... rest of template ... -->
</template>
```

Update `src/components/SettingsDialog.vue` to add ClinGen cache management section.

Read the current SettingsDialog.vue to understand its tab structure, then add a new section within an appropriate tab (or create a "Data" tab).

Add ClinGen cache management section:

```vue
<!-- ClinGen Cache Management Section -->
<v-card
  variant="outlined"
  class="mb-4"
>
  <v-card-title class="text-subtitle-1">
    <v-icon start size="small">mdi-database-sync</v-icon>
    ClinGen Data Cache
  </v-card-title>

  <v-card-text>
    <div class="d-flex align-center justify-space-between mb-2">
      <div>
        <div class="text-body-2">
          <strong>Status:</strong>
          <v-chip
            :color="clingenExpired ? 'warning' : 'success'"
            size="x-small"
            class="ml-2"
          >
            {{ clingenExpired ? 'Expired' : 'Valid' }}
          </v-chip>
        </div>
        <div class="text-caption text-medium-emphasis">
          {{ clingenEntryCount }} entries | Last updated: {{ clingenCacheAge }}
        </div>
      </div>

      <v-btn
        variant="outlined"
        size="small"
        :loading="clingenLoading"
        @click="refreshClingenCache"
      >
        <v-icon start size="small">mdi-refresh</v-icon>
        Refresh
      </v-btn>
    </div>

    <v-alert
      v-if="clingenError"
      type="error"
      variant="tonal"
      density="compact"
      class="mt-2"
    >
      {{ clingenError }}
    </v-alert>

    <div class="text-caption text-medium-emphasis mt-2">
      ClinGen data is used to validate gene-disease associations.
      Cache expires after 30 days and refreshes automatically.
    </div>
  </v-card-text>
</v-card>
```

Add script for ClinGen management:
```typescript
import { useClingenValidity } from '@/composables';

const {
  isLoading: clingenLoading,
  error: clingenError,
  isExpired: clingenExpired,
  cacheAge: clingenCacheAge,
  entryCount: clingenEntryCount,
  refreshCache: refreshClingenCache,
} = useClingenValidity();
```

Also add a small section showing disclaimer status and ability to re-show it:

```vue
<!-- Disclaimer Section -->
<v-card
  variant="outlined"
  class="mb-4"
>
  <v-card-title class="text-subtitle-1">
    <v-icon start size="small">mdi-alert-circle-outline</v-icon>
    Clinical Disclaimer
  </v-card-title>

  <v-card-text>
    <div class="d-flex align-center justify-space-between">
      <div class="text-body-2">
        <span v-if="appStore.disclaimerAcknowledged">
          Acknowledged on {{ appStore.acknowledgedDate }}
        </span>
        <span v-else>
          Not yet acknowledged
        </span>
      </div>

      <v-btn
        v-if="appStore.disclaimerAcknowledged"
        variant="text"
        size="small"
        @click="appStore.resetDisclaimer()"
      >
        Show Again
      </v-btn>
    </div>
  </v-card-text>
</v-card>
```

Import appStore:
```typescript
import { useAppStore } from '@/stores/useAppStore';
const appStore = useAppStore();
```
  </action>
  <verify>Run `bun run dev`:
1. Clear localStorage, reload - disclaimer dialog appears
2. Click "I Understand" - dialog closes, doesn't reappear on refresh
3. Open Settings - see ClinGen cache status and refresh button
4. Click "Show Again" in settings - disclaimer reappears
</verify>
  <done>Disclaimer integrated at app level, ClinGen cache management in settings</done>
</task>

</tasks>

<verification>
1. `bun run typecheck` passes
2. `bun run lint` passes
3. Fresh browser (cleared localStorage):
   - Disclaimer dialog appears immediately
   - Cannot close by clicking outside
   - Clicking "I Understand" closes and persists
4. Subsequent visits: disclaimer does not appear
5. Settings dialog:
   - Shows ClinGen cache status
   - Refresh button works
   - Shows disclaimer acknowledgment date
   - "Show Again" button re-displays disclaimer
</verification>

<success_criteria>
- Disclaimer shown as modal dialog on first visit
- Acknowledgment persists to localStorage
- Disclaimer not shown after acknowledgment
- ClinGen cache status visible in settings
- Manual ClinGen cache refresh works (CLIN-03)
- Disclaimer can be re-shown from settings
</success_criteria>

<output>
After completion, create `.planning/phases/09-clingen-documentation/09-04-SUMMARY.md`
</output>
