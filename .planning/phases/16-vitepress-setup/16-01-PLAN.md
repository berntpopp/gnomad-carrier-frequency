---
phase: 16-vitepress-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.ts
  - .gitignore
  - Makefile
  - docs/.vitepress/config.ts
  - docs/.vitepress/theme/index.ts
  - docs/.vitepress/theme/custom.css
autonomous: true

must_haves:
  truths:
    - "VitePress is installed and importable as a devDependency"
    - "Running npm run docs:dev starts a VitePress dev server without errors"
    - "Theme colors use #a09588 brand color in light mode and #c0b5a8 in dark mode"
    - "PWA service worker does not intercept /docs/ path requests"
    - "VitePress cache and dist directories are gitignored"
    - "Makefile docs targets invoke the correct npm scripts"
  artifacts:
    - path: "docs/.vitepress/config.ts"
      provides: "VitePress site configuration with nav, sidebar, search, social links"
      exports: ["default"]
    - path: "docs/.vitepress/theme/index.ts"
      provides: "Theme entry extending default with custom CSS"
      exports: ["default"]
    - path: "docs/.vitepress/theme/custom.css"
      provides: "Brand color CSS variable overrides for light and dark mode"
      contains: "--vp-c-brand-1"
    - path: "package.json"
      provides: "docs:dev, docs:build, docs:preview scripts"
      contains: "docs:dev"
    - path: "vite.config.ts"
      provides: "PWA navigateFallbackDenylist for /docs/ path"
      contains: "navigateFallbackDenylist"
    - path: ".gitignore"
      provides: "VitePress cache and dist exclusions"
      contains: ".vitepress/cache"
    - path: "Makefile"
      provides: "docs, docs-dev, docs-preview targets and updated ci/help"
      contains: "docs-dev"
  key_links:
    - from: "Makefile"
      to: "package.json"
      via: "npm run docs:* scripts"
      pattern: "npm run docs:"
    - from: "docs/.vitepress/theme/index.ts"
      to: "docs/.vitepress/theme/custom.css"
      via: "CSS import"
      pattern: "import.*custom\\.css"
    - from: "vite.config.ts"
      to: "docs/ path"
      via: "navigateFallbackDenylist regex"
      pattern: "navigateFallbackDenylist.*docs"
---

<objective>
Install VitePress and create the documentation site infrastructure with configuration, theme customization, PWA coexistence, and build tooling.

Purpose: Establish the VitePress foundation so that content pages (Plan 02) can be added and the docs site can be developed, built, and previewed using standard npm scripts and Makefile targets.

Output: VitePress installed, configured with navigation/sidebar/search/theme, PWA denylist active, build scripts and Makefile targets working.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-vitepress-setup/16-CONTEXT.md
@.planning/phases/16-vitepress-setup/16-RESEARCH.md
@vite.config.ts
@package.json
@Makefile
@.gitignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install VitePress and create site configuration with theme</name>
  <files>
    package.json
    docs/.vitepress/config.ts
    docs/.vitepress/theme/index.ts
    docs/.vitepress/theme/custom.css
  </files>
  <action>
    1. Install VitePress alpha (required for Vite 7 compatibility):
       ```
       npm add -D vitepress@next
       ```

    2. Create `docs/.vitepress/config.ts` with the following configuration:
       - title: "gnomAD Carrier Frequency Docs"
       - description: "Calculate carrier frequencies for autosomal recessive conditions from gnomAD data"
       - base: '/gnomad-carrier-frequency/docs/' (trailing slash required)
       - appearance: true (dark mode follows system preference)
       - head: favicon link pointing to '/gnomad-carrier-frequency/favicon.svg' (reuses app favicon)
       - themeConfig.nav: Guide, Use Cases, Reference, About sections + "Open Calculator" link to '/gnomad-carrier-frequency/' (external, target _blank) + GitHub social link
       - themeConfig.sidebar: Multi-sidebar config with hierarchical structure for each section:
         - /guide/: Introduction, Getting Started
         - /use-cases/: Overview, Carrier Screening, Family Planning, Clinical Letter
         - /reference/: Overview, Methodology, Data Sources, Filters, Templates
         - /about/: Overview, Citation, Changelog
       - themeConfig.search: { provider: 'local' } for built-in offline search
       - themeConfig.socialLinks: GitHub repo link only

    3. Create `docs/.vitepress/theme/index.ts`:
       - Import DefaultTheme from 'vitepress/theme'
       - Import './custom.css'
       - Export DefaultTheme (no modifications, just CSS override)

    4. Create `docs/.vitepress/theme/custom.css`:
       - Light mode (:root): --vp-c-brand-1: #a09588, --vp-c-brand-2: #8a7f72, --vp-c-brand-3: #6d665c, --vp-c-brand-soft: rgba(160, 149, 136, 0.14)
       - Dark mode (.dark): --vp-c-brand-1: #c0b5a8, --vp-c-brand-2: #a09588, --vp-c-brand-3: #8a7f72, --vp-c-brand-soft: rgba(160, 149, 136, 0.16)

    IMPORTANT: Use `import { defineConfig } from 'vitepress'` (ESM, not require). VitePress is ESM-only.
    IMPORTANT: The "Open Calculator" nav link should use the full path '/gnomad-carrier-frequency/' and open in a new tab. VitePress nav supports external links by default when the link is absolute.
  </action>
  <verify>
    - `ls docs/.vitepress/config.ts docs/.vitepress/theme/index.ts docs/.vitepress/theme/custom.css` shows all 3 files exist
    - `grep -q "vitepress" package.json` confirms VitePress is in devDependencies
    - `grep -q "base.*gnomad-carrier-frequency/docs" docs/.vitepress/config.ts` confirms correct base path
    - `grep -q "vp-c-brand-1.*#a09588" docs/.vitepress/theme/custom.css` confirms brand color
  </verify>
  <done>VitePress installed as devDependency, config.ts has full navigation/sidebar/search config, theme extends default with #a09588 brand color overrides for both light and dark modes</done>
</task>

<task type="auto">
  <name>Task 2: Add PWA denylist, gitignore entries, package.json scripts, and Makefile targets</name>
  <files>
    vite.config.ts
    .gitignore
    package.json
    Makefile
  </files>
  <action>
    1. Modify `vite.config.ts` — add `navigateFallbackDenylist: [/^\/docs/]` to the workbox config object, immediately after the existing `navigateFallback: 'index.html'` line. Do NOT change any other workbox or PWA settings.

    2. Append to `.gitignore` — add a "VitePress" section at the end:
       ```
       # VitePress
       docs/.vitepress/cache
       docs/.vitepress/dist
       ```

    3. Add scripts to `package.json` — add these three scripts alongside existing ones:
       - "docs:dev": "vitepress dev docs"
       - "docs:build": "vitepress build docs"
       - "docs:preview": "vitepress preview docs"
       Also update the "ci" script to include docs build: "npm run lint && npm run typecheck && npm run build && npm run docs:build && npm run lighthouse"

    4. Update `Makefile`:
       a. Add to .PHONY line: docs docs-dev docs-preview
       b. Add a "Documentation:" section to the help target output (after the "Testing:" section, before "Cleanup:"):
          ```
          @echo "Documentation:"
          @echo "  make docs           - Build VitePress documentation site"
          @echo "  make docs-dev       - Start docs dev server"
          @echo "  make docs-preview   - Preview docs production build"
          @echo ""
          ```
       c. Add the three targets (before the clean target):
          ```
          # Build VitePress documentation site
          docs:
          	npm run docs:build

          # Start docs dev server
          docs-dev:
          	npm run docs:dev

          # Preview docs production build
          docs-preview:
          	npm run docs:preview
          ```
       d. Update the ci target to include docs build:
          ```
          ci:
          	npm run ci
          ```
          (The ci npm script already includes docs:build from step 3, so the Makefile target needs no change — it already calls `npm run ci`)

    IMPORTANT: The Makefile ci target already delegates to `npm run ci`, so updating the npm ci script in package.json is sufficient. Do NOT duplicate the command chain in the Makefile.
    IMPORTANT: Use tabs (not spaces) for Makefile recipe lines.
  </action>
  <verify>
    - `grep -q "navigateFallbackDenylist" vite.config.ts` confirms PWA denylist added
    - `grep -q ".vitepress/cache" .gitignore` confirms gitignore updated
    - `node -e "const p=require('./package.json'); console.log(p.scripts['docs:dev'])"` prints "vitepress dev docs"
    - `grep -q "docs-dev" Makefile` confirms Makefile target exists
    - `grep -q "docs:build" package.json` confirms docs build script exists in ci pipeline
    - `npm run docs:build` completes without errors (may warn about missing pages, that's OK — Plan 02 adds content)
  </verify>
  <done>PWA service worker excludes /docs/ path via navigateFallbackDenylist, .gitignore has VitePress entries, package.json has docs:dev/build/preview scripts with ci including docs:build, Makefile has docs/docs-dev/docs-preview targets with updated help output</done>
</task>

</tasks>

<verification>
1. `npm run docs:dev` starts VitePress dev server (may show warnings about missing content pages — expected, Plan 02 adds them)
2. `grep "navigateFallbackDenylist" vite.config.ts` returns the denylist regex
3. `grep ".vitepress" .gitignore` shows cache and dist entries
4. `make help` shows Documentation section with docs targets
5. `npm run docs:build` completes successfully
</verification>

<success_criteria>
- VitePress alpha installed as devDependency compatible with project's Vite 7
- Config has navigation (Guide, Use Cases, Reference, About, Calculator link), hierarchical sidebar, local search, GitHub social link
- Theme uses #a09588 brand color with proper dark mode variant
- PWA service worker will not intercept /docs/ requests
- Build tooling complete: npm scripts + Makefile targets + updated CI pipeline
</success_criteria>

<output>
After completion, create `.planning/phases/16-vitepress-setup/16-01-SUMMARY.md`
</output>
