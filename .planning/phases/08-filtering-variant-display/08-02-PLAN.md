---
phase: 08-filtering-variant-display
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/queries/gene-variants.ts
  - src/api/queries/types.ts
  - src/types/variant.ts
  - src/types/display.ts
  - src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "GraphQL query returns HGVS coding and protein notation"
    - "Display variant type includes all columns needed for variant modal"
    - "API response types match extended query fields"
  artifacts:
    - path: "src/api/queries/gene-variants.ts"
      provides: "Extended GraphQL query with hgvsc and hgvsp fields"
      contains: "hgvsc"
    - path: "src/types/variant.ts"
      provides: "TranscriptConsequence with HGVS fields"
      contains: "hgvsc"
    - path: "src/types/display.ts"
      provides: "DisplayVariant type for variant modal table"
      exports: ["DisplayVariant"]
  key_links:
    - from: "src/api/queries/gene-variants.ts"
      to: "gnomAD GraphQL API"
      via: "transcript_consequence fields"
      pattern: "hgvsc.*hgvsp"
    - from: "src/types/display.ts"
      to: "src/types/variant.ts"
      via: "GnomadVariant base"
      pattern: "GnomadVariant|ClinVarVariant"
---

<objective>
Extend GraphQL query for HGVS fields and create display types for variant modal.

Purpose: The variant modal needs HGVS coding (hgvsc) and protein (hgvsp) notation to display clinical-relevant variant names. This plan extends the API query and creates the display types that combine gnomAD and ClinVar data for table rendering.

Output: Extended query fetches HGVS fields, display types ready for VariantModal component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-filtering-variant-display/08-CONTEXT.md
@.planning/phases/08-filtering-variant-display/08-RESEARCH.md

@src/api/queries/gene-variants.ts (current GraphQL query)
@src/api/queries/types.ts (API response types)
@src/types/variant.ts (current variant types)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend GraphQL query for HGVS fields</name>
  <files>src/api/queries/gene-variants.ts</files>
  <action>
Add HGVS fields to the GENE_VARIANTS_QUERY transcript_consequence block:

In the transcript_consequence selection, add after lof_flags:
- `hgvsc` - HGVS coding notation (e.g., "c.1234A>G")
- `hgvsp` - HGVS protein notation (e.g., "p.Met123Val")

The updated transcript_consequence block should be:
```graphql
transcript_consequence {
  gene_symbol
  transcript_id
  canonical
  consequence_terms
  lof
  lof_filter
  lof_flags
  hgvsc
  hgvsp
}
```

Note: These fields are available in gnomAD GraphQL API (per research document).
  </action>
  <verify>
`bun run typecheck` passes. Query string includes hgvsc and hgvsp.
  </verify>
  <done>
GENE_VARIANTS_QUERY includes hgvsc and hgvsp in transcript_consequence selection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update type definitions for HGVS fields</name>
  <files>src/types/variant.ts, src/api/queries/types.ts</files>
  <action>
1. In `src/types/variant.ts`, update `TranscriptConsequence` interface:
   Add:
   - `hgvsc: string | null` - HGVS coding notation
   - `hgvsp: string | null` - HGVS protein notation

2. Check `src/api/queries/types.ts` for any duplicate type definitions that need updating (if GeneVariantsResponse defines transcript_consequence inline, update there too).

Ensure both internal types and API response types include the new fields.
  </action>
  <verify>
`bun run typecheck` passes with updated type definitions.
  </verify>
  <done>
TranscriptConsequence type includes hgvsc and hgvsp as optional string fields.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create display variant types for modal</name>
  <files>src/types/display.ts, src/types/index.ts</files>
  <action>
Create `src/types/display.ts` with types for variant modal display:

1. `DisplayVariant` interface - flattened structure for table display:
   - `variant_id: string` - Primary identifier (e.g., "1-12345-A-G")
   - `pos: number` - Genomic position
   - `ref: string` - Reference allele
   - `alt: string` - Alternate allele
   - `consequence: string` - Human-readable consequence (e.g., "missense_variant")
   - `alleleFrequency: number | null` - Computed AF (exome + genome combined)
   - `alleleCount: number` - Total AC
   - `alleleNumber: number` - Total AN
   - `clinvarStatus: string | null` - ClinVar classification or null
   - `goldStars: number | null` - ClinVar review stars or null
   - `hgvsc: string | null` - HGVS coding
   - `hgvsp: string | null` - HGVS protein
   - `transcriptId: string | null` - Transcript ID
   - `lof: string | null` - LoF annotation (HC/LC/OS)
   - `isLoF: boolean` - True if LoF HC
   - `isClinvarPathogenic: boolean` - True if ClinVar P/LP
   - `isMissense: boolean` - True if missense consequence

2. `PopulationVariantFrequency` interface - per-population display:
   - `populationCode: string`
   - `populationLabel: string`
   - `alleleFrequency: number | null`
   - `alleleCount: number`
   - `alleleNumber: number`

3. Export from `src/types/index.ts`
  </action>
  <verify>
`bun run typecheck` passes. Types can be imported from '@/types'.
  </verify>
  <done>
DisplayVariant and PopulationVariantFrequency types exported and ready for VariantModal component.
  </done>
</task>

</tasks>

<verification>
1. `bun run typecheck` passes
2. `bun run lint` passes
3. Query includes HGVS fields: `grep -q "hgvsc" src/api/queries/gene-variants.ts`
4. Types importable: `import { DisplayVariant, PopulationVariantFrequency } from '@/types'`
5. TranscriptConsequence includes hgvsc/hgvsp
</verification>

<success_criteria>
1. GENE_VARIANTS_QUERY fetches hgvsc and hgvsp from gnomAD API
2. TranscriptConsequence type includes hgvsc and hgvsp fields
3. DisplayVariant type has all columns needed for variant modal (VAR-02)
4. All TypeScript compilation passes
5. Existing code that uses variant types continues to work (no breaking changes)
</success_criteria>

<output>
After completion, create `.planning/phases/08-filtering-variant-display/08-02-SUMMARY.md`
</output>
