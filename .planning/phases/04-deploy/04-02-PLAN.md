---
phase: 04-deploy
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - .github/workflows/ci.yml
  - .github/workflows/deploy.yml
autonomous: true

must_haves:
  truths:
    - "CI workflow runs lint and typecheck on all branch pushes"
    - "Deploy workflow builds and deploys to GitHub Pages on main pushes"
    - "Workflows use official GitHub Actions (actions/checkout, actions/setup-node, actions/deploy-pages)"
  artifacts:
    - path: ".github/workflows/ci.yml"
      provides: "CI workflow for all branches"
      contains: "npm run lint"
    - path: ".github/workflows/deploy.yml"
      provides: "Deploy workflow for main branch"
      contains: "actions/deploy-pages"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: "package.json"
      via: "npm run lint and npm run typecheck scripts"
      pattern: "npm run (lint|typecheck)"
    - from: ".github/workflows/deploy.yml"
      to: "dist/"
      via: "upload-pages-artifact action"
      pattern: "path.*dist"
---

<objective>
Create GitHub Actions workflows for CI and deployment.

Purpose: Automate code quality checks on every push and deploy to GitHub Pages when main branch is updated.

Output: Two workflow files - ci.yml for all branches, deploy.yml for main branch deployment.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-deploy/04-RESEARCH.md
@.planning/phases/04-deploy/04-01-SUMMARY.md

@package.json
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CI workflow</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Create `.github/workflows/ci.yml` with lint and typecheck jobs:

```yaml
name: CI

on:
  push:
    branches: ['*']
  pull_request:
    branches: ['main']

jobs:
  lint-and-typecheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: actions/setup-node@v6
        with:
          node-version: lts/*
          cache: 'npm'

      - run: npm ci

      - name: Lint
        run: npm run lint

      - name: Type Check
        run: npm run typecheck
```

Key points:
- Runs on ALL branch pushes (not just main) to catch issues early
- Uses `npm ci` (not `npm install`) for deterministic builds from lock file
- Uses `cache: 'npm'` for automatic npm cache handling
- Uses LTS Node version for stability
- Separate named steps for lint and typecheck for clear failure identification
  </action>
  <verify>
File exists at `.github/workflows/ci.yml` with correct YAML syntax.
Verify syntax: `cat .github/workflows/ci.yml | python3 -c "import yaml, sys; yaml.safe_load(sys.stdin)"`
  </verify>
  <done>CI workflow file created with lint and typecheck steps, runs on all branches</done>
</task>

<task type="auto">
  <name>Task 2: Create Deploy workflow</name>
  <files>.github/workflows/deploy.yml</files>
  <action>
Create `.github/workflows/deploy.yml` using the official Vite GitHub Pages pattern:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: ['main']
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: actions/setup-node@v6
        with:
          node-version: lts/*
          cache: 'npm'

      - run: npm ci

      - name: Build
        run: npm run build

      - name: Configure Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: './dist'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

Key points:
- Only runs on main branch pushes (and manual workflow_dispatch)
- Requires explicit permissions: pages:write and id-token:write
- Uses concurrency group to prevent conflicting deploys
- Uses official actions/deploy-pages@v4 (not peaceiris/actions-gh-pages)
- Uploads dist/ folder as artifact for deployment
- Outputs deployment URL for verification
  </action>
  <verify>
File exists at `.github/workflows/deploy.yml` with correct YAML syntax.
Verify syntax: `cat .github/workflows/deploy.yml | python3 -c "import yaml, sys; yaml.safe_load(sys.stdin)"`
  </verify>
  <done>Deploy workflow file created with build and GitHub Pages deployment steps</done>
</task>

</tasks>

<verification>
1. Both workflow files exist in .github/workflows/
2. YAML syntax is valid for both files
3. ci.yml triggers on all branches with lint and typecheck steps
4. deploy.yml triggers on main with proper permissions and deploy-pages action
</verification>

<success_criteria>
- .github/workflows/ci.yml created with lint + typecheck on all branches
- .github/workflows/deploy.yml created with build + deploy on main only
- Both use official GitHub Actions (checkout@v5, setup-node@v6, deploy-pages@v4)
- Deploy workflow has required permissions (pages:write, id-token:write)
- Both use npm ci and npm cache for efficient builds
</success_criteria>

<output>
After completion, create `.planning/phases/04-deploy/04-02-SUMMARY.md`
</output>
