---
phase: 02-wizard-ui
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/wizard/StepGene.vue
  - src/components/wizard/StepStatus.vue
  - src/components/wizard/StepFrequency.vue
autonomous: true

must_haves:
  truths:
    - "User can search and select a gene in Step 1"
    - "User can toggle between carrier and affected status in Step 2"
    - "User can choose frequency source (gnomAD/literature/default) in Step 3"
    - "Literature source requires frequency value and PMID"
    - "Each step shows Continue/Back buttons appropriately"
  artifacts:
    - path: "src/components/wizard/StepGene.vue"
      provides: "Gene selection step component"
      min_lines: 30
    - path: "src/components/wizard/StepStatus.vue"
      provides: "Index patient status selection step"
      min_lines: 40
    - path: "src/components/wizard/StepFrequency.vue"
      provides: "Frequency source selection with tabs"
      min_lines: 80
  key_links:
    - from: "src/components/wizard/StepGene.vue"
      to: "src/components/GeneSearch.vue"
      via: "imports and uses existing GeneSearch component"
      pattern: "import GeneSearch from"
    - from: "src/components/wizard/StepFrequency.vue"
      to: "src/composables/useCarrierFrequency.ts"
      via: "displays gnomAD calculated frequency"
      pattern: "globalFrequency"
---

<objective>
Create the three input step components for the wizard flow.

Purpose: Build the user-facing steps that collect gene, status, and frequency source inputs. These components receive wizard state via props and emit events for state changes.

Output: StepGene.vue, StepStatus.vue, StepFrequency.vue in src/components/wizard/
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-wizard-ui/02-CONTEXT.md
@.planning/phases/02-wizard-ui/02-RESEARCH.md
@.planning/phases/02-wizard-ui/02-01-SUMMARY.md
@src/components/GeneSearch.vue
@src/composables/useCarrierFrequency.ts
@src/config/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StepGene component</name>
  <files>src/components/wizard/StepGene.vue</files>
  <action>
Create `src/components/wizard/StepGene.vue`:

1. Props:
   - modelValue: GeneSearchResult | null (current selected gene)

2. Emits:
   - update:modelValue: (gene: GeneSearchResult | null)
   - complete: () - emitted when user clicks Continue with valid selection

3. Template:
   - Title: "Step 1: Select Gene"
   - Reuse existing GeneSearch component with v-model binding
   - Include VersionSelector for gnomAD version selection
   - Continue button (disabled when no gene selected)

4. Pattern from RESEARCH.md:
```vue
<template>
  <div>
    <h3 class="text-h6 mb-4">Select Gene</h3>
    <p class="text-body-2 text-medium-emphasis mb-4">
      Search for a gene symbol to calculate carrier frequency.
    </p>

    <div class="mb-4" style="max-width: 300px">
      <VersionSelector />
    </div>

    <GeneSearch :model-value="modelValue" @update:model-value="onGeneChange" />

    <div class="d-flex justify-end mt-6">
      <v-btn
        color="primary"
        :disabled="!modelValue"
        @click="$emit('complete')"
      >
        Continue
      </v-btn>
    </div>
  </div>
</template>
```

Note: GeneSearch emits 'select' not 'update:modelValue'. Wire @select to update:modelValue emit.
  </action>
  <verify>Component exists and has props/emits defined. Run `npm run typecheck`.</verify>
  <done>StepGene.vue displays gene search and version selector with Continue button</done>
</task>

<task type="auto">
  <name>Task 2: Create StepStatus component</name>
  <files>src/components/wizard/StepStatus.vue</files>
  <action>
Create `src/components/wizard/StepStatus.vue`:

1. Props:
   - modelValue: IndexPatientStatus (current status)

2. Emits:
   - update:modelValue: (status: IndexPatientStatus)
   - complete: ()
   - back: ()

3. Template (from CONTEXT.md - simple toggle, default carrier):
   - Title: "Step 2: Index Patient Status"
   - Explanation text
   - v-switch between carrier (heterozygous) and affected (compound het/homozygous)
   - Use pattern from RESEARCH.md (v-switch with custom labels on both sides)
   - Help tooltip with v-tooltip explaining the difference
   - Back and Continue buttons

4. Implementation:
```vue
<template>
  <div>
    <h3 class="text-h6 mb-4">Index Patient Status</h3>
    <p class="text-body-2 text-medium-emphasis mb-4">
      Select whether the index patient is a carrier or affected.
    </p>

    <v-card variant="outlined" class="pa-4 mb-4">
      <div class="d-flex align-center justify-center">
        <span :class="{ 'text-medium-emphasis': isAffected, 'font-weight-bold': !isAffected }">
          Carrier (heterozygous)
        </span>
        <v-switch
          v-model="isAffected"
          class="mx-4"
          color="primary"
          hide-details
          inset
        />
        <span :class="{ 'text-medium-emphasis': !isAffected, 'font-weight-bold': isAffected }">
          Affected (compound het/homozygous)
        </span>
        <v-tooltip location="top">
          <template #activator="{ props }">
            <v-icon v-bind="props" class="ml-2" size="small">
              mdi-help-circle-outline
            </v-icon>
          </template>
          <span>Carrier: one pathogenic allele. Affected: two pathogenic alleles.</span>
        </v-tooltip>
      </div>
    </v-card>

    <div class="d-flex justify-space-between mt-6">
      <v-btn variant="text" @click="$emit('back')">Back</v-btn>
      <v-btn color="primary" @click="$emit('complete')">Continue</v-btn>
    </div>
  </div>
</template>
```

5. Script:
   - Computed isAffected that maps modelValue to boolean and emits update on change
   - 'heterozygous' = false, 'compound_het_homozygous' = true
  </action>
  <verify>Component exists with toggle working. Run `npm run typecheck`.</verify>
  <done>StepStatus.vue displays toggle between carrier and affected with help tooltip</done>
</task>

<task type="auto">
  <name>Task 3: Create StepFrequency component</name>
  <files>src/components/wizard/StepFrequency.vue</files>
  <action>
Create `src/components/wizard/StepFrequency.vue`:

1. Props:
   - source: FrequencySource (current source)
   - literatureFrequency: number | null
   - literaturePmid: string | null
   - gnomadFrequency: { percent: string; ratio: string } | null (calculated value from gnomAD)
   - gnomadLoading: boolean
   - usingDefault: boolean (true if gnomAD found no qualifying variants)

2. Emits:
   - update:source: (source: FrequencySource)
   - update:literatureFrequency: (freq: number | null)
   - update:literaturePmid: (pmid: string | null)
   - complete: ()
   - back: ()

3. Template using v-tabs + v-window (Vuetify 3 pattern from RESEARCH.md):
   - Title: "Step 3: Frequency Source"
   - v-tabs with three tabs: gnomAD, Literature, Default
   - v-window with content for each tab

4. Tab content:

   **gnomAD tab:**
   - Show loading state if gnomadLoading
   - Show calculated frequency if available: "Calculated carrier frequency: {ratio} ({percent})"
   - If usingDefault, show alert: "No qualifying variants found. Using default assumption."
   - "Use gnomAD Value" button to confirm selection

   **Literature tab:**
   - v-text-field for frequency (decimal 0-1, validate-on="blur")
   - v-text-field for PMID (numeric only, validate-on="blur")
   - Validation rules from RESEARCH.md
   - Both fields required for this source

   **Default tab:**
   - Show default value from config (1:100)
   - Explanation: "Use when no gene-specific data available"
   - Auto-selected when tab active

5. Validation:
   - gnomad: valid when gnomadFrequency exists OR usingDefault
   - literature: valid when frequency > 0, <= 1, and pmid is non-empty numeric
   - default: always valid

6. Continue button disabled until current source is valid
  </action>
  <verify>Component renders all three tabs. Run `npm run typecheck`. Check tab switching works.</verify>
  <done>StepFrequency.vue displays tabs for gnomAD/literature/default sources with validation</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck` passes
- [ ] `src/components/wizard/` directory created with all 3 components
- [ ] StepGene reuses existing GeneSearch and VersionSelector
- [ ] StepStatus shows toggle with carrier as default
- [ ] StepFrequency has 3 tabs (gnomAD, Literature, Default)
- [ ] Literature tab validates frequency (0-1) and PMID (numeric)
- [ ] All steps have Back/Continue buttons (except Step 1 has no Back)
</verification>

<success_criteria>
- All three step components created and type-safe
- GeneSearch reused (not recreated)
- Status toggle defaults to carrier (heterozygous)
- Frequency tabs switch correctly with v-window
- Literature validation prevents invalid values
- Components ready to wire into WizardStepper
</success_criteria>

<output>
After completion, create `.planning/phases/02-wizard-ui/02-02-SUMMARY.md`
</output>
