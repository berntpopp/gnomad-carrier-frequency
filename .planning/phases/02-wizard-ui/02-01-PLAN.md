---
phase: 02-wizard-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/wizard.ts
  - src/types/index.ts
  - src/composables/useWizard.ts
  - src/composables/index.ts
autonomous: true

must_haves:
  truths:
    - "Wizard state tracks current step (1-4)"
    - "Wizard state tracks selected gene"
    - "Wizard state tracks index patient status"
    - "Wizard state tracks frequency source and values"
    - "Changing earlier step values resets downstream steps"
  artifacts:
    - path: "src/types/wizard.ts"
      provides: "WizardState, FrequencySource, WizardStep types"
      exports: ["WizardState", "FrequencySource", "WizardStep"]
    - path: "src/composables/useWizard.ts"
      provides: "Wizard state management composable"
      exports: ["useWizard"]
  key_links:
    - from: "src/composables/useWizard.ts"
      to: "src/types/wizard.ts"
      via: "imports WizardState type"
      pattern: "import.*WizardState.*wizard"
    - from: "src/composables/useWizard.ts"
      to: "src/types/frequency.ts"
      via: "imports IndexPatientStatus"
      pattern: "import.*IndexPatientStatus"
---

<objective>
Create wizard types and state management composable.

Purpose: Foundation for the 4-step wizard flow - all state management logic centralized in useWizard composable with proper downstream reset when earlier steps change.

Output: Type definitions for wizard state and a composable that manages step navigation, validation, and state coordination.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-wizard-ui/02-CONTEXT.md
@.planning/phases/02-wizard-ui/02-RESEARCH.md
@src/types/frequency.ts
@src/composables/useCarrierFrequency.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create wizard types</name>
  <files>src/types/wizard.ts, src/types/index.ts</files>
  <action>
Create `src/types/wizard.ts` with:

```typescript
export type WizardStep = 1 | 2 | 3 | 4;
export type FrequencySource = 'gnomad' | 'literature' | 'default';

export interface WizardState {
  currentStep: WizardStep;
  // Step 1: Gene
  gene: GeneSearchResult | null;
  // Step 2: Status
  indexStatus: IndexPatientStatus;
  // Step 3: Frequency source
  frequencySource: FrequencySource;
  literatureFrequency: number | null;
  literaturePmid: string | null;
}
```

Import `IndexPatientStatus` from `./frequency` and `GeneSearchResult` from `@/api/queries/types`.

Export all new types from `src/types/index.ts`.
  </action>
  <verify>Run `npm run typecheck` - no errors</verify>
  <done>WizardState, FrequencySource, WizardStep types defined and exported</done>
</task>

<task type="auto">
  <name>Task 2: Create useWizard composable</name>
  <files>src/composables/useWizard.ts, src/composables/index.ts</files>
  <action>
Create `src/composables/useWizard.ts` that:

1. Uses reactive() for WizardState with defaults:
   - currentStep: 1
   - gene: null
   - indexStatus: 'heterozygous' (user decision: default to carrier)
   - frequencySource: 'gnomad'
   - literatureFrequency: null
   - literaturePmid: null

2. Provides computed validation per step:
   - Step 1 valid: gene !== null
   - Step 2 valid: always valid (has default)
   - Step 3 valid:
     - gnomad: always valid (uses calculated value)
     - literature: literatureFrequency > 0 AND literatureFrequency <= 1 AND literaturePmid is non-empty
     - default: always valid (uses config value)

3. Provides canProceed computed based on currentStep and validation

4. Implements downstream reset watchers (from CONTEXT.md decision):
   - When gene changes and currentStep > 1: reset to step 1, reset indexStatus to default, reset frequencySource to 'gnomad', clear literature values
   - When indexStatus changes and currentStep > 2: don't reset step (status doesn't affect frequency source)
   - When frequencySource changes and currentStep > 3: don't reset step (source is step 3)

5. Provides navigation methods:
   - nextStep(): if canProceed, increment currentStep (max 4)
   - prevStep(): if currentStep > 1, decrement currentStep
   - goToStep(step: WizardStep): if step <= currentStep OR all prior steps valid, set currentStep

6. Returns: state, canProceed, nextStep, prevStep, goToStep, resetWizard

Use @vueuse/core patterns from the research doc.
  </action>
  <verify>Run `npm run typecheck` - no errors. Review composable has all methods documented.</verify>
  <done>useWizard composable exports state management with validation and downstream reset logic</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck` passes
- [ ] `src/types/wizard.ts` exports WizardState, FrequencySource, WizardStep
- [ ] `src/composables/useWizard.ts` exports useWizard function
- [ ] Types re-exported from `src/types/index.ts`
- [ ] Composable re-exported from `src/composables/index.ts`
- [ ] Validation logic matches step requirements
- [ ] Downstream reset triggers on gene change
</verification>

<success_criteria>
- Wizard types fully defined
- useWizard composable provides complete step navigation API
- Downstream reset works (gene change resets later steps)
- All exports accessible via barrel files
</success_criteria>

<output>
After completion, create `.planning/phases/02-wizard-ui/02-01-SUMMARY.md`
</output>
