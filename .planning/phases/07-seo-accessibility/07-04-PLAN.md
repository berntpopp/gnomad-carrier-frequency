---
phase: 07-seo-accessibility
plan: 04
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - lighthouserc.json
  - .github/workflows/lighthouse.yml
  - src/App.vue
autonomous: false

must_haves:
  truths:
    - "Lighthouse CI runs on push to main and PRs"
    - "Build fails if Lighthouse scores below thresholds"
    - "Heading elements follow sequential order (h1 -> h2 -> h3)"
    - "Keyboard navigation works throughout app"
  artifacts:
    - path: "lighthouserc.json"
      provides: "Lighthouse CI configuration"
      contains: "categories:accessibility"
    - path: ".github/workflows/lighthouse.yml"
      provides: "GitHub Actions workflow for Lighthouse"
      contains: "lighthouse-ci-action"
  key_links:
    - from: ".github/workflows/lighthouse.yml"
      to: "lighthouserc.json"
      via: "configPath parameter"
      pattern: "configPath.*lighthouserc.json"
---

<objective>
Set up Lighthouse CI for automated accessibility and SEO score verification, audit heading hierarchy, and verify keyboard navigation.

Purpose: Ensure Lighthouse scores meet thresholds (INFRA-05 >= 90, INFRA-06 >= 95, INFRA-07 >= 95), verify SEO-02 (heading order), and confirm SEO-06 (keyboard navigation).

Output: Lighthouse CI workflow, heading hierarchy audit, keyboard navigation verification
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-seo-accessibility/07-RESEARCH.md
@.planning/phases/07-seo-accessibility/07-CONTEXT.md
@.planning/phases/07-seo-accessibility/07-01-SUMMARY.md
@.github/workflows/deploy.yml
@src/App.vue
@src/components/wizard/WizardStepper.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Lighthouse CI configuration</name>
  <files>lighthouserc.json, .github/workflows/lighthouse.yml</files>
  <action>
1. Create lighthouserc.json in project root:

```json
{
  "ci": {
    "collect": {
      "numberOfRuns": 3,
      "startServerCommand": "bun run preview",
      "startServerReadyPattern": "Local:",
      "startServerReadyTimeout": 30000,
      "url": ["http://localhost:4173/gnomad-carrier-frequency/"]
    },
    "assert": {
      "assertions": {
        "categories:performance": ["warn", { "minScore": 0.9 }],
        "categories:accessibility": ["error", { "minScore": 0.95 }],
        "categories:seo": ["error", { "minScore": 0.95 }]
      }
    },
    "upload": {
      "target": "temporary-public-storage"
    }
  }
}
```

Note: Performance is "warn" (not blocking) while accessibility and SEO are "error" (blocking). This allows perf variations in CI while enforcing a11y/SEO.

2. Create .github/workflows/lighthouse.yml:

```yaml
name: Lighthouse CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Install dependencies
        run: bun install

      - name: Build
        run: bun run build

      - name: Run Lighthouse CI
        uses: treosh/lighthouse-ci-action@v12
        with:
          configPath: './lighthouserc.json'
          uploadArtifacts: true
```
  </action>
  <verify>Files exist with correct content: `cat lighthouserc.json`, `cat .github/workflows/lighthouse.yml`</verify>
  <done>Lighthouse CI configuration and workflow created</done>
</task>

<task type="auto">
  <name>Task 2: Audit and fix heading hierarchy</name>
  <files>src/App.vue, src/components/wizard/WizardStepper.vue</files>
  <action>
Audit all heading elements to ensure sequential order (SEO-02).

Current structure analysis:
1. App.vue has h1 "gnomAD Carrier Frequency Calculator" - this is correct as main page heading
2. Wizard steps may need h2 or h3 for section headings

Check each wizard step component for heading usage:
- StepGene.vue
- StepStatus.vue
- StepFrequency.vue
- StepResults.vue

Headings should follow:
- h1: Page title (in App.vue - already correct)
- h2: Major sections (wizard step titles if headings are used)
- h3: Subsections within steps

If any step uses headings, ensure they're h2 or lower (not h1).

Read through step components and verify/fix:
```bash
grep -rn "<h[1-6]" src/components/wizard/
```

If any step has its own h1, change it to h2. If step has h2 that should be subordinate to step title, change to h3.

Common fixes:
- Step component with `<h1>` -> change to `<h2 class="text-h5">`
- Nested heading `<h2>` inside step that already has h2 -> change to `<h3>`

Note: Vuetify text- classes (text-h4, text-h5) are purely visual and don't affect HTML semantics. The actual `<h1>`, `<h2>` etc. tags define document outline.
  </action>
  <verify>
`grep -rn "<h[1-6]" src/` shows exactly one h1 (in App.vue) and any other headings are h2 or lower in proper sequence.
  </verify>
  <done>Heading hierarchy follows sequential order (h1 -> h2 -> h3)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete SEO and accessibility implementation:
1. Meta tags and structured data (Plan 01)
2. ARIA announcer infrastructure (Plan 02)
3. Wizard announcements and dialog focus trap (Plan 03)
4. Lighthouse CI workflow and heading audit (this plan)
  </what-built>
  <how-to-verify>
**Keyboard Navigation Test (SEO-06):**
1. Start the dev server: `bun run dev`
2. Open http://localhost:5173/gnomad-carrier-frequency/ in browser
3. Press Tab repeatedly - confirm focus moves through all interactive elements
4. Press Enter on focused buttons - confirm they activate
5. Click the settings gear icon
6. With Settings dialog open:
   - Tab through all elements (tabs, buttons) - focus should stay inside dialog
   - Press Escape - dialog should close
   - Focus should return to the gear icon
7. Navigate through wizard steps using keyboard only:
   - Type gene name in search field, use arrow keys to select, Enter to confirm
   - Tab to Next button, Enter to proceed
   - Continue through all steps

**Visual Check:**
- Focus indicator (ring/outline) is visible on focused elements
- No double h1 tags in page (inspect with DevTools)

**Screen Reader Check (optional but recommended):**
- Enable screen reader (NVDA on Windows, VoiceOver on Mac)
- Navigate through wizard
- Confirm step changes and results are announced
  </how-to-verify>
  <resume-signal>Type "approved" if keyboard navigation works correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `ls lighthouserc.json .github/workflows/lighthouse.yml` confirms files exist
2. `cat lighthouserc.json | jq .ci.assert.assertions` shows score thresholds
3. `grep -rn "<h[1-6]" src/` shows proper heading hierarchy
4. Manual keyboard navigation test passes
</verification>

<success_criteria>
- lighthouserc.json exists with performance >= 90, accessibility >= 95, seo >= 95 thresholds
- .github/workflows/lighthouse.yml runs on push and PR
- Heading hierarchy audit complete - no skipped levels, single h1
- Keyboard navigation verified working (Tab, Enter, Escape throughout app)
- User approves keyboard navigation behavior at checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/07-seo-accessibility/07-04-SUMMARY.md`
</output>
